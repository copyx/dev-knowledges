# Container

가상머신처럼 독립적으로 실행되지만, 더 빠르고, 더 쉽고, 더 효율적인 도구

## 컨테이너가 만들어진 이유

### 서버관리는 복잡하다!

해야할 작업이 너무 많다!

- Add user
- System Env
- Firewall
- Network
- Dependencies
- Python
- Git clone
- Package
- Configuration
- Migration
- Proxy
- Run!

게다가 서버환경도, 개발환경도 계속 바뀐다!

Python 버전을 업데이트하면? 패키지 버전을 올리면? 어느 단계에서든 문제가 생기면 서버는 정상적으로 동작하지 않는다!

### 서버의 상태를 관리하기 위한 노력의 과정

#### 1. 문서화를 잘 해보자!

- 👍 정보를 전달할 수 있다!
- 😥 세세한 내용까지 모든 내용을 문서화하기 힘듦
- 😥 변경 관리 및 최신화가 어려움

#### 2. 서버 상태 관리 도구(CHEF, Ansible, Puppet labs) 사용

- 👍 코드로 자동화!
- 😥 도구에 대한 학습이 필요
- 😥 서버 설정이 복잡해지면 도구 사용의 난이도가 올라감
  - 예) 한 서버에 다른 버전 여러개 어떻게 설치?

#### 3. 가상머신(Virtual Machine, VM)

- 👍 격리된 환경 구성!
- 👍 현 상태 저장!
- 😥 클라우드 환경과 안 맞는 부분이 있음
- 😥 특정 벤더에 종속성이 생김
- 😥 기본적으로 좀 느림

#### 4. 컨테이너(Docker)

2013년 DotCloud(현 Docker)에서 첫 공개 ([발표영상 유튜브 링크](https://www.youtube.com/watch?v=wW9CAH9nSLs))

리뉵스 커널의 여러 기술을 활용해 격리된 환경에서 프로세스를 작동시키는 기술. 하드웨어 가상화보다 가볍고, 이미지 단위로 프로세스 실행 환경을 구성.~~(구글 같은 회사들은 내부적으로 이러한 자원격리 기술을 이미 사용하고 있었다고함. 쳇)~~

- VM 보다 컨테이너 생성이 쉽고 효율적
- 컨테이너 이미지를 이용한 배포와 롤백이 간단함
- 언어, 프레임워크와 상관없이 애플리케이션을 동일한 방식으로 관리
- 개발, 테스팅, 운영환경은 물론 로컬 PC와 클라우드까지 동일한 환경 구축
- 특정 벤더에 종속적이지 않음

## 배포 방식의 변화

![Container Evolution](/images/container_evolution.svg)
이미지 출처: https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/

### 1. Traditional Deployment

- 물리 서버에서 실행
- 여러 애플리케이션 각각의 리소스 한계를 정의할 방법이 없어서 리소스 할당의 문제가 발생
- 서로 다른 물리서버를 사용할 수 있지만, 리소스 활용이 비효율적이고 비용이 높음

### 2. Virtualized Deployment

- 가상화 도입으로 한 물리 서버에서 여러 가상 시스템(VM: Virtual Machine)을 실행
- VM은 가상화된 하드웨어 위에서 운영체제를 포함한 모든 구성요소를 실행하는 하나의 완전한 기기
- 가상화를 사용하면 물리 서버의 리소스를 더 효율적으로 활용 가능
- 각각의 애플리케이션을 격리해 일정 수준의 보안성 제공
- 애플리케이션 추가 및 업데이트 용이
- 하드웨어 비용 절감
- 가상화를 통해 물리 리소스를 일회영 가상 머신으로 구성된 클러스터로 만들 수 있음

### 3. Container Deployment

- VM과 비슷하지만 분리 속성을 완화해 애플리케이션 사이에 OS를 공유하고 이로인해 가볍다고 생각함
- VM 보다 이미지 생성이 쉽고 효율적임
  - 안정적이고 효율적으로 빌드, 배포 및 롤백 가능
  - 느슨한 결합의, 분산된, 탄력적인, 해방된 마이크로서비스 구현 가능
- OS 수준의 정보 & 메트릭을 넘어 애플리케이션의 헬스와 시그널 관찰 가능
- 가상 하드웨어 위에 OS 구동에서 논리적 자원을 사용하는 OS 위에 애플리케이션을 구동하는 것으로 추상화 수준이 높아짐
- 리소스 분리: 예측 가능한 애플리케이션 성능
- 리소스 활용: 고효율 고밀도

## VM vs Docker

- VM: Host OS 위에 Hypervisor 위에 Guest OS
- Docker: Host OS 위에 Docker Engine

가상의 환경 구성이 아닌 격리만 해서 Docker가 더 가벼움.

## 특징

- 확장성/이식성
  - 어디든 도커만 있으면 컨테이너 실행 가능
  - 오픈소스라 특정 회사/서비스에 종속적이지 않음
- 표준성
  - 컨테이너라는 표준으로 서버를 배포해 모든 서비스들의 배포 과정이 동일해짐
    - 원래는 환경에 따라 설정 및 구성이 달라져서 그 과정도 달랐음
- 이미지
  - 이미지를 통해 컨테이너 생성
  - Dockerfile을 이용해 이미지 빌드 재현이 가능하고 기록도 남길 수 있음
  - 이미지 저장소에 저장하고 운영 서버에서 불러오기 가능
- 설정관리
  - 보통 환경변수로 설정 제어 (컨테이너 띄울 때 환경변수 같이 지정)
  - 이미지가 환경변수에 따라 동적으로 설정파일을 생성하도록 만들어져야함
- 자원관리
  - 컨테이너 삭제 시 모든 데이터 초기화
  - 파일은 외부 스토리지나 저장소, 세션이나 캐시도 memcached, redis를 이용해 외부로 분리

## 컨테이너의 미래

### [Kubernetes](kubernetes.md)

여러대의 서버와 여러개의 서비스를 관리하기 쉽게!

# Reference

- [초보를 위한 도커 안내서 - subicura](https://www.inflearn.com/course/%EB%8F%84%EC%BB%A4-%EC%9E%85%EB%AC%B8/) : 강의 수강하며 나온 내용들 정리
- [쿠버네티스란 무엇인가? | Kubernetes](https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/)
